---
title: "Assignment 2"
author: "Lillian (Wei) Hung"
date: "2021/10/4"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F)
```

```{r}
#run this section first before " library (tigris)"

library(tidyverse)
library(sf)
library(mapview)
library(leaflet)
library(censusapi)
library(devtools)
#install_github('walkerke/tigris', force = TRUE )
```


```{r}
library(tigris)

Sys.setenv(CENSUS_KEY="c8100bd1d2b42c5942616b53158bee261f69edbe")

```


```{r}
smc_pop_2020 <-
  getCensus(
    name = "dec/pl",
    vintage = 2020,
    region = "block:*", 
    regionin = "state:06+county:081",
    vars = "P1_001N"
  ) %>% 
  transmute(
    block =
      paste0(state,county,tract,block),
    pop = P1_001N
  ) %>% 
  transmute(
    GEOID20 = block,
    pop_2020 = pop
  )


dec_vars_2020 <-
  listCensusMetadata(
    name = "2020/dec/pl",
    type = "variables"
  ) 

smc_blocks_2020 <- blocks("CA", "San Mateo", year = 2020, progress_bar = F)

Redwood_boundary <- places("CA", progress_bar = F) %>% 
  filter(NAME == "Redwood City")

Redwood_pop_2020 <- smc_pop_2020 %>% 
  left_join(smc_blocks_2020 %>% select(GEOID20)) %>% 
  st_as_sf() %>% 
  st_centroid() %>% 
  .[Redwood_boundary, ] %>% 
  st_set_geometry(NULL) %>% 
  left_join(smc_blocks_2020 %>% select( GEOID20)) %>% 
  st_as_sf()

```


```{r}
mapview(Redwood_pop_2020, zcol = "pop_2020")
```

```{r}
smc_pop_2010 <-
  getCensus(
    name = "dec/pl",
    vintage = 2010,
    region = "block:*", 
    regionin = "state:06+county:081",
    vars = "P001001"
  ) %>% 
  transmute(
    block =
      paste0(state,county,tract,block),
    pop = P001001
  ) %>% 
  transmute(
    GEOID10 = block,
    pop_2010 = pop
  )
```

```{r}
dec_vars_2010 <-
  listCensusMetadata(
    name = "2010/dec/pl",
    type = "variables"
  )
```

```{r}
smc_blocks_2010 <- blocks("CA", "San Mateo", year = 2010, progress_bar = F)

Redwood_boundary <- places("CA", progress_bar = F) %>% 
  filter(NAME == "Redwood City")

Redwood_pop_2010 <- smc_pop_2010 %>% 
  left_join(smc_blocks_2010 %>% select( GEOID10)) %>% 
  st_as_sf() %>% 
  st_centroid() %>% 
  .[Redwood_boundary, ] %>% 
  st_set_geometry(NULL) %>% 
  left_join(smc_blocks_2010 %>% select( GEOID10)) %>% 
  st_as_sf()
```

```{r}
mapview(Redwood_pop_2010, zcol = "pop_2010")

```


```{r}
Redwood_pop <- st_join(Redwood_pop_2020, Redwood_pop_2010)
Redwood_pop$increase <- Redwood_pop$pop_2020 - Redwood_pop$pop_2010
Redwood_pop$percentage <- case_when( 
  Redwood_pop$pop_2020 == 0 & !Redwood_pop$pop_2010 == 0 ~100,
  Redwood_pop$pop_2020 == 0 & Redwood_pop$pop_2010 == 0 ~0,
  TRUE ~ Redwood_pop$increase/Redwood_pop$pop_2020)
```

```{r}
mapview(Redwood_pop, zcol = "increase")
```

```{r}
mapview(Redwood_pop, zcol = "percentage")
```

For assignment 2, I choose Redwood City to analyze its population change between 2010 and 2020. Redwood City is a city located in San Mateo County California. As shown in the map, some blocks remain the same population and the overall population has increased between 2010 and 2020. According to the population increase map, the population of two blocks with the color yellow increased significantly. The reason might be the increase in local job opportunities and local developments. For instance, the area is providing flexible space for businesses, including new technologies and light industrial uses. As for some blocks in Redwood City, births, deaths, and migration might be the main causes of population decline. Fewer children are born and better-educated people move to larger cities.






